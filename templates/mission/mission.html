{% extends "base.html" %}
{% block css %}
    img {
        max-width: 100%;
        max-height: 100vh;
        margin: auto;
        align-self: center;
    }
    .mission-item {
        background-color: #c0392b;
        margin-top: 1px;
        margin-bottom: 1px;
        color: #ecf0f1;
        font-size: 1.25em;
    }
    #inputdiv {
        background-color: #c0392b;
        color: #ecf0f1;
        padding-bottom: 10px;
        margin-bottom: 10px;
        box-shadow: 0px 0px 10px 1px #333333;
    }
{% endblock %}
{% block title %}Mission{% endblock %}


{% block content %}
    <div id="inputdiv">
        <h2>Entrez le nom de la cible Ã  trouver :</h2>
        <input type="text" onKeyUP="trackChange(this.value)" id="missionInput">
    </div>
    {% for name, place, urls in mission %}
        <div class="mission-item" id="{{ name }}" onclick="setInput('{{ name }}')">{{ name }}
            {% for url in urls %}
                <img src="{{ url }}" class="mission-item" onclick="setZoom(this.id)" id="{{ name }}_{{ forloop.counter }}">
            {% endfor %}
        </div>
    {% endfor %}
{% endblock %}


{% block js %}
    var missionitem = document.getElementsByClassName("mission-item");

    for(var i = 0; i < missionitem.length; i++) {
        missionitem.item(i).style.display = 'none';
    }

    function trackChange(value){
        var nbfound = 0;
        for(var i = 0; i < missionitem.length; i++) {
            if (value.length > 0 && missionitem.item(i).id.toLowerCase().split("_")[0].includes(value.toLowerCase())){
                if ( missionitem.item(i).tagName == "DIV"){
                    missionitem.item(i).style.display = 'block';
                    nbfound++;
                }
            } else {
                if ( missionitem.item(i).tagName == "DIV"){
                    missionitem.item(i).style.display = 'none';
                }
            }
        }
        if (nbfound == 1){
            for(var i = 0; i < missionitem.length; i++) {
                if (missionitem.item(i).id.toLowerCase().includes(value.toLowerCase())){
                    if ( missionitem.item(i).tagName == "IMG"){
                        missionitem.item(i).style.display = 'block';
                    }
                }
            }
        } else {
            for(var i = 0; i < missionitem.length; i++) {
                if ( missionitem.item(i).tagName == "IMG"){
                    missionitem.item(i).style.display = 'none';
                }
            }
        }
    }
    function setInput(name){
        var input = document.getElementById("missionInput");
        input.value = name;
        trackChange(name);
    }
    function setZoom(id){
        console.log(id)
        var img = document.getElementById(id);
        console.log(img.style.maxHeight)
        if (img.style.maxHeight == '100%'){
            img.style.maxHeight = '100vh';
        } else {
            img.style.maxHeight = '100%';
        }
    }
{% endblock %}
